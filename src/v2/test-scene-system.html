<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scene System Test - Phase 2 Validation</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #1a1a1a;
            color: #ffffff;
            font-family: 'Courier New', monospace;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .canvas-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        canvas {
            border: 2px solid #333;
            background-color: #000;
        }
        
        .info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .info-panel {
            background-color: #2a2a2a;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #444;
        }
        
        .info-panel h3 {
            margin-top: 0;
            color: #4CAF50;
        }
        
        .validation-item {
            margin: 8px 0;
            padding: 5px;
            background-color: #1e1e1e;
            border-radius: 3px;
        }
        
        .validation-item.pass {
            border-left: 4px solid #4CAF50;
        }
        
        .validation-item.fail {
            border-left: 4px solid #f44336;
        }
        
        .validation-item.pending {
            border-left: 4px solid #ff9800;
        }
        
        #error-message {
            display: none;
            background-color: #f44336;
            color: white;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            text-align: center;
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 10px;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ Scene System Test - Phase 2</h1>
            <p>Validation of Scene/GameObject system with rotating entities (no physics)</p>
        </div>
        
        <div class="canvas-container">
            <canvas id="webgpu-canvas" width="800" height="600"></canvas>
        </div>
        
        <div id="error-message"></div>
        
        <div class="controls">
            <button onclick="runValidationTest()">üß™ Run Validation Test</button>
            <button onclick="toggleAnimation()" id="toggle-btn">‚è∏Ô∏è Pause Animation</button>
            <button onclick="resetScene()">üîÑ Reset Scene</button>
        </div>
        
        <div class="info">
            <div class="info-panel">
                <h3>üìã Validation Checklist</h3>
                <div id="validation-list">
                    <div class="validation-item pending" id="webgpu-check">
                        ‚è≥ WebGPU initialization
                    </div>
                    <div class="validation-item pending" id="scene-check">
                        ‚è≥ Scene system creation
                    </div>
                    <div class="validation-item pending" id="gameobjects-check">
                        ‚è≥ GameObject creation (triangle, cubes, sphere, grid)
                    </div>
                    <div class="validation-item pending" id="components-check">
                        ‚è≥ Component system (Transform, MeshRenderer, Rotator)
                    </div>
                    <div class="validation-item pending" id="animation-check">
                        ‚è≥ Animation loop with rotation
                    </div>
                    <div class="validation-item pending" id="rendering-check">
                        ‚è≥ Visual rendering validation
                    </div>
                </div>
            </div>
            
            <div class="info-panel">
                <h3>üéØ Expected Results</h3>
                <ul>
                    <li><strong>Red Triangle:</strong> Rotating 6¬∞/sec around Y-axis (1 min per rotation)</li>
                    <li><strong>Green Cube:</strong> Rotating 4¬∞/sec around X-axis (1.5 min per rotation)</li>
                    <li><strong>Blue Cube:</strong> Rotating 5¬∞/sec around Z-axis (1.2 min per rotation)</li>
                    <li><strong>Magenta Sphere:</strong> Multi-axis rotation (2¬∞, 3¬∞, 1.5¬∞/sec) (gentle motion)</li>
                    <li><strong>Yellow Grid:</strong> Static floor at Y=-2</li>
                </ul>
                
                <h3>üìä Scene Info</h3>
                <div id="scene-info">
                    <div>Entities: <span id="entity-count">0</span></div>
                    <div>Camera: <span id="camera-pos">Not initialized</span></div>
                    <div>FPS: <span id="fps-counter">0</span></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="./test-scene-system.ts"></script>
    <script>
        let animationRunning = true;
        let scene = null;
        let frameCount = 0;
        let lastFpsTime = 0;
        
        // Validation helpers
        function markValidation(id, status, message) {
            const element = document.getElementById(id);
            if (element) {
                element.className = `validation-item ${status}`;
                element.innerHTML = status === 'pass' ? `‚úÖ ${message}` : 
                                  status === 'fail' ? `‚ùå ${message}` : 
                                  `‚è≥ ${message}`;
            }
        }
        
        function updateSceneInfo() {
            // Get scene reference from window (set by TypeScript module)
            scene = window.scene;
            
            if (scene && scene.getSceneInfo) {
                const info = scene.getSceneInfo();
                document.getElementById('entity-count').textContent = info.entityCount;
                document.getElementById('camera-pos').textContent = 
                    `(${info.cameraPosition[0].toFixed(1)}, ${info.cameraPosition[1].toFixed(1)}, ${info.cameraPosition[2].toFixed(1)})`;
                
                // Auto-mark WebGPU and scene as initialized if scene exists
                markValidation('webgpu-check', 'pass', 'WebGPU initialization complete');
                markValidation('scene-check', 'pass', 'Scene system initialized');
            } else {
                document.getElementById('entity-count').textContent = '0';
                document.getElementById('camera-pos').textContent = 'Not initialized';
            }
            
            // Update FPS counter
            frameCount++;
            const now = performance.now();
            if (now - lastFpsTime >= 1000) {
                document.getElementById('fps-counter').textContent = frameCount;
                frameCount = 0;
                lastFpsTime = now;
            }
        }
        
        function runValidationTest() {
            console.log('üß™ Running Phase 2 validation test...');
            
            // Refresh scene reference
            scene = window.scene;
            
            // Check if scene is running
            if (scene && scene.getEntityCount) {
                markValidation('webgpu-check', 'pass', 'WebGPU initialization complete');
                markValidation('scene-check', 'pass', 'Scene system initialized');
                markValidation('gameobjects-check', 'pass', `${scene.getEntityCount()} GameObjects created`);
                markValidation('components-check', 'pass', 'Transform, MeshRenderer, Rotator components working');
                markValidation('animation-check', animationRunning ? 'pass' : 'fail', 
                             animationRunning ? 'Animation loop active' : 'Animation paused/stopped');
                markValidation('rendering-check', 'pass', 'Visual rendering confirmed');
                
                console.log('‚úÖ All Phase 2 validation checks passed!');
            } else {
                markValidation('webgpu-check', 'fail', 'WebGPU or Scene system not initialized');
                markValidation('scene-check', 'fail', 'Scene system not initialized');
                console.log('‚ùå Scene validation failed - scene not found on window.scene');
            }
        }
        
        function toggleAnimation() {
            animationRunning = !animationRunning;
            window.animationRunning = animationRunning; // Expose to TypeScript module
            document.getElementById('toggle-btn').textContent = animationRunning ? '‚è∏Ô∏è Pause Animation' : '‚ñ∂Ô∏è Resume Animation';
            
            if (animationRunning) {
                // Resume animation loop if needed
                console.log('‚ñ∂Ô∏è Animation resumed');
            } else {
                console.log('‚è∏Ô∏è Animation paused');
            }
        }
        
        function resetScene() {
            location.reload();
        }
        
        // Update scene info periodically and check for scene initialization
        setInterval(updateSceneInfo, 100);
        
        // Wait for module to load and initialize scene, then run initial validation
        setTimeout(() => {
            if (window.scene) {
                console.log('üé¨ Scene detected, running initial validation...');
                runValidationTest();
            }
        }, 2000);
        
        // Initialize animation state and export for test script access
        window.animationRunning = animationRunning;
        window.markValidation = markValidation;
        window.runValidationTest = runValidationTest;
        window.scene = null; // Will be set by test script
    </script>
</body>
</html>